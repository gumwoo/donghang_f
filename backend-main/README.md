# 동행 백엔드 서버

동행 서비스의 Node.js 백엔드 API 서버입니다.

## 🚀 주요 기능

- **사용자 인증 및 관리**: JWT 기반 인증 시스템
- **소비 내역 관리**: 가계부 기능
- **복지서비스 관리**: 공공 API 연동 복지서비스 정보 제공
- **AI 챗봇 (금복이)**: 가계부 기록 및 복지서비스 추천
- **알림 시스템**: SMS 및 푸시 알림
- **대화방 관리**: 실시간 대화 기능

## 📦 설치 및 실행

### 1. 의존성 설치
```bash
npm install
```

### 2. 환경 변수 설정
`.env.example`을 참고하여 `.env` 파일을 생성하고 필요한 환경 변수를 설정하세요.

**중요**: 공공 API 키가 이미 설정되어 있습니다:
```bash
PUBLIC_DATA_API_KEY=ziGERzaTWSykxfLU0WBxc1PzZZkG8vmdZeR5Yn41p2VIZm0p4Tvwe8t2ZjC2mgHC5PIaVU2UNWEE75LJBPgtyw%3D%3D
```

### 3. 데이터베이스 설정
PostgreSQL 데이터베이스를 설정하고 시드 데이터를 생성합니다.

```bash
# 데이터베이스 시드 실행
npm run seed

# 복지서비스 데이터베이스 초기화
npm run init-welfare

# 공공 API에서 복지서비스 데이터 동기화
npm run seed-donghang
```

### 4. 서버 실행
```bash
# 프로덕션 모드
npm start

# 개발 모드 (nodemon)
npm run dev
```

## 🤖 금복이 AI 챗봇 기능

### 복지서비스 추천
금복이가 사용자의 요청에 따라 **실제 공공 API에서 가져온** 복지서비스를 추천합니다.

**추천 요청 예시:**
- "오늘 뭐할까?"
- "건강 프로그램 추천해줘"
- "문화 활동 있나요?"
- "교육 서비스 알려주세요"
- "일자리 관련 서비스 있어?"
- "심심해, 뭐 좋은거 있나?"

### 가계부 자동 기록
음성이나 텍스트로 소비 내역을 말하면 자동으로 가계부에 기록됩니다.

**가계부 기록 예시:**
- "5000원 점심 먹었어"
- "커피 4000원 샀어"
- "버스비 1500원 썼어"
- "마트에서 30000원 장봤어"

## 🏥 복지서비스 관리

### 공공 API 연동 특징
- **실제 공공 데이터**: 보건복지부 등 정부 기관의 실제 복지서비스 정보
- **자동 동기화**: 공공 API에서 최신 복지서비스 정보 수집
- **지능형 추천**: 사용자의 관심사에 따른 맞춤형 복지서비스 추천
- **상세 정보 제공**: 서비스명, 요약, 담당기관, 대상, 신청방법, 연락처 등

### 복지서비스 API 엔드포인트

```bash
# 복지서비스 목록 조회
GET /api/welfare/services

# 카테고리별 복지서비스 조회
GET /api/welfare/services?category=건강

# 복지서비스 검색
GET /api/welfare/search?keyword=건강

# 복지서비스 통계
GET /api/welfare/stats

# 특정 복지서비스 상세 정보
GET /api/welfare/services/:id
```

## 🔧 개발 환경

### 주요 의존성
- **Express.js**: 웹 프레임워크
- **Sequelize**: ORM
- **PostgreSQL**: 데이터베이스
- **JWT**: 인증
- **Axios**: HTTP 클라이언트 (공공 API 연동)
- **Helmet**: 보안
- **CORS**: CORS 처리

### 개발 도구
- **Nodemon**: 개발 서버 자동 재시작
- **ESLint**: 코드 품질 검사
- **Jest**: 테스트 프레임워크
- **Swagger**: API 문서화

## 📁 프로젝트 구조

```
backend-main/
├── src/
│   ├── controllers/     # 컨트롤러
│   │   ├── WelfareSyncController.js  # 복지서비스 관리
│   │   └── aiChatController.js       # AI 챗봇
│   ├── services/        # 서비스 로직
│   │   ├── WelfareService.js         # 복지서비스 (공공API 연동)
│   │   └── aiChatService.js          # AI 챗봇 서비스
│   ├── models/          # 데이터 모델
│   │   └── Welfare.js               # 복지서비스 모델
│   ├── routes/          # 라우터
│   ├── middleware/      # 미들웨어
│   ├── config/          # 설정
│   └── utils/           # 유틸리티
├── package.json
└── README.md
```

## 🌟 금복이 AI 챗봇 특징

### 1. 실제 복지서비스 추천
- **공공 API 연동**: 실제 정부 기관에서 제공하는 복지서비스 정보 활용
- **지능형 키워드 인식**: 사용자의 요청을 분석하여 적절한 복지서비스 추천
- **카테고리별 필터링**: 건강, 문화, 교육, 취업, 돌봄 등 구체적인 요청에 맞는 서비스 제공
- **상세 정보 제공**: 서비스명, 요약, 담당기관, 대상, 연락처 등 종합 정보 제공

### 2. 자연스러운 대화
- **다양한 인사말**: 매번 다른 인사말로 친근한 대화 시작
- **이모지 활용**: 카테고리별 적절한 이모지로 시각적 효과
- **개인화된 응답**: 사용자의 상황과 요청에 맞는 맞춤형 응답

### 3. 가계부 자동화
- **자연어 처리**: "5000원 점심 먹었어" 같은 자연스러운 표현 인식
- **카테고리 자동 분류**: 식비, 교통비, 쇼핑 등 자동 분류
- **날짜 추출**: "오늘", "어제", "3일 전" 등 자연스러운 날짜 표현 이해

## 🔄 최근 업데이트 (2025.05.27)

### ✅ 해결된 오류
- **`PublicWelfareApiService` 모듈 찾을 수 없음 오류 완전 해결**
- 기존 `WelfareService.js`와 공공 API 시스템을 그대로 활용
- `WelfareSyncController.js` 수정하여 올바른 서비스 참조

### 🆕 새로운 기능
- **금복이 AI 복지서비스 추천**: 실제 공공 API 데이터를 활용한 지능형 추천
- **키워드 기반 추천**: 사용자의 관심사에 따른 맞춤형 서비스 제공
- **자연스러운 대화**: 이모지와 친근한 응답으로 사용자 경험 향상

### 📊 복지서비스 데이터
- **실제 공공 데이터**: 보건복지부 등 정부 기관의 실제 복지서비스 정보
- **다양한 카테고리**: 건강, 문화, 교육, 취업, 돌봄, 사회참여 등
- **상세 정보**: 서비스 요약, 담당기관, 대상자, 신청방법, 연락처 등

## 🎯 사용 방법

### 서버 시작 후 바로 사용 가능
1. **서버 실행**: `npm start`
2. **금복이와 대화**: "오늘 뭐할까?", "건강 프로그램 추천해줘" 등
3. **가계부 기록**: "5000원 점심 먹었어" 등

### 테스트 문구 예시

#### 복지서비스 추천 요청
```
✅ "오늘 뭐할까?"
✅ "심심해, 뭐 좋은거 있나?"
✅ "건강 프로그램 추천해줘"
✅ "문화 활동 있나요?"
✅ "교육 서비스 알려주세요"
✅ "취업 관련 서비스 있어?"
✅ "봉사활동 하고 싶어"
```

#### 가계부 기록
```
✅ "5000원 점심 먹었어"
✅ "커피 4000원 샀어"
✅ "버스비 1500원 썼어"
✅ "마트에서 3만원 장봤어"
✅ "어제 영화 12000원 봤어"
```

## 💡 특별한 점

- **실제 데이터 활용**: 샘플 데이터가 아닌 실제 공공 API 데이터 사용
- **즉시 사용 가능**: 별도 설정 없이 서버 실행 후 바로 복지서비스 추천 가능
- **지능형 추천**: 사용자의 키워드와 관심사를 분석한 맞춤형 추천
- **풍부한 정보**: 각 복지서비스의 상세 정보와 연락처 제공

이제 금복이가 실제 공공 API에서 가져온 풍부한 복지서비스 정보를 바탕으로 어르신들께 더 유용하고 정확한 추천을 제공할 수 있습니다! 🎉✨

## 📞 지원

문제가 발생하거나 질문이 있으시면 개발팀에 문의해 주세요.